# Trip-Mate Backend ‚úàÔ∏è

<p align="center">
  <img src="https://raw.githubusercontent.com/KBLReddy/trip-mate-backend/main/logo.png" alt="Trip-Mate Logo" width="200"/>
</p>

<p align="center">
  <strong>The definitive backend solution for collaborative trip planning.</strong>
  <br />
  Built with NestJS, Prisma, and PostgreSQL.
</p>

<p align="center">
    <a href="https://nestjs.com/" target="_blank"><img src="https://img.shields.io/badge/NestJS-E0234E?style=for-the-badge&logo=nestjs&logoColor=white" alt="NestJS"></a>
    <a href="https://www.prisma.io/" target="_blank"><img src="https://img.shields.io/badge/Prisma-2D3748?style=for-the-badge&logo=prisma&logoColor=white" alt="Prisma"></a>
    <a href="https://www.postgresql.org/" target="_blank"><img src="https://img.shields.io/badge/PostgreSQL-4169E1?style=for-the-badge&logo=postgresql&logoColor=white" alt="PostgreSQL"></a>
    <a href="https://www.typescriptlang.org/" target="_blank"><img src="https://img.shields.io/badge/TypeScript-3178C6?style=for-the-badge&logo=typescript&logoColor=white" alt="TypeScript"></a>
</p>

Welcome to the Trip-Mate backend repository! This project provides a robust, scalable, and secure API for the Trip-Mate application, a platform designed to make planning group trips seamless and enjoyable. This document will guide you through every aspect of the project, making it a cake walk to get started, regardless of your experience with NestJS.

---

## üìã Table of Contents

-   [‚ú® Core Features](#-core-features)
-   [üõ†Ô∏è Tech Stack](#Ô∏è-tech-stack)
-   [üìÅ Project Structure](#-project-structure)
-   [üöÄ Getting Started](#-getting-started)
    -   [Prerequisites](#prerequisites)
    -   [Installation & Setup](#installation--setup)
    -   [Running the Application](#running-the-application)
-   [üîê API Authentication Flow](#-api-authentication-flow)
-   [üìö API Endpoint Documentation](#-api-endpoint-documentation)
    -   [Auth Module (`/auth`)](#auth-module-auth)
    -   [Users Module (`/users`)](#users-module-users)
    -   [Trips Module (`/trips`)](#trips-module-trips)
-   [ü§ù Contributing](#-contributing)
-   [üìú License](#-license)

---

## ‚ú® Core Features

-   **Secure User Management**: JWT-based authentication for user registration and login.
-   **Collaborative Trip Planning**: Create trips and invite friends to plan together.
-   **Itinerary Management**: Add and organize destinations within a trip.
-   **Activity Scheduling**: Plan activities for each destination with dates and details.
-   **Shared Expense Tracking**: Log expenses, categorize them, and manage the trip budget transparently.
-   **Data Validation**: Robust request validation using `class-validator` to ensure data integrity.
-   **Scalable Architecture**: Modular design powered by NestJS for easy maintenance and extension.

---

## üõ†Ô∏è Tech Stack

-   **Framework**: [NestJS](https://nestjs.com/) - A progressive Node.js framework for building efficient and scalable server-side applications.
-   **Language**: [TypeScript](https://www.typescriptlang.org/) - Typed superset of JavaScript that compiles to plain JavaScript.
-   **ORM**: [Prisma](https://www.prisma.io/) - Next-generation Node.js and TypeScript ORM for type-safe database access.
-   **Database**: [PostgreSQL](https://www.postgresql.org/) - A powerful, open-source object-relational database system.
-   **Authentication**: [Passport.js](http://www.passportjs.org/) with JWT Strategy for secure, stateless authentication.
-   **Validation**: [class-validator](https://github.com/typestack/class-validator) & [class-transformer](https://github.com/typestack/class-transformer) for validating incoming request bodies.

---

## üìÅ Project Structure

The project follows a standard modular architecture. Understanding the structure is key to understanding the application's flow.

```
.
‚îú‚îÄ‚îÄ prisma/
‚îÇ   ‚îú‚îÄ‚îÄ migrations/         # Contains SQL migration files generated by Prisma.
‚îÇ   ‚îî‚îÄ‚îÄ schema.prisma       # The single source of truth for your database schema and models.
‚îÇ
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ auth/               # Handles all authentication logic (login, register).
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ dto/            # Data Transfer Objects defining the shape of auth-related request bodies.
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ guards/         # Route guards, like `JwtAuthGuard` to protect endpoints.
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ auth.controller.ts # Defines the `/auth` API routes.
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ auth.service.ts   # Contains the business logic for authentication.
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ jwt.strategy.ts # Implements the logic to validate JWTs.
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ users/              # Manages user-related operations (e.g., fetching profiles).
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ users.controller.ts # Defines the `/users` API routes.
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ users.service.ts    # Business logic for user operations.
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ trips/              # The core module for all trip-related functionality.
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ dto/            # DTOs for trips, destinations, activities, and expenses.
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ trips.controller.ts # Defines all `/trips` routes and sub-routes.
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ trips.service.ts    # Contains all business logic for managing trips and their related entities.
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ common/             # Shared utilities.
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ decorators/     # Custom decorators (e.g., `@GetUser` to inject user object into requests).
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ app.module.ts       # The root module that ties all other modules together.
‚îÇ   ‚îî‚îÄ‚îÄ main.ts             # The application's entry point. It creates and starts the NestJS app.
‚îÇ
‚îú‚îÄ‚îÄ .env.example            # Template for your environment variables.
‚îú‚îÄ‚îÄ package.json            # Lists project dependencies and scripts.
‚îî‚îÄ‚îÄ tsconfig.json           # Configuration for the TypeScript compiler.
```

---

## üöÄ Getting Started

Follow these steps to get a local copy of the project up and running.

### Prerequisites

-   [Node.js](https://nodejs.org/en/) (v16 or newer)
-   [npm](https://www.npmjs.com/) or [Yarn](https://yarnpkg.com/)
-   [Git](https://git-scm.com/)
-   [PostgreSQL](https://www.postgresql.org/download/) server running locally.
    -   *Alternative*: [Docker](https://www.docker.com/products/docker-desktop/) for a containerized database setup.

### Installation & Setup

1.  **Clone the Repository**
    ```bash
    git clone https://github.com/KBLReddy/trip-mate-backend.git
    cd trip-mate-backend
    ```

2.  **Install Dependencies**
    ```bash
    npm install
    ```

3.  **Configure Environment Variables**
    Create a `.env` file in the root directory by copying the example file.
    ```bash
    cp .env.example .env
    ```
    Open the `.env` file and set the following variables:
    ```env
    # --- Database Configuration ---
    # Your PostgreSQL connection string.
    # Format: postgresql://USER:PASSWORD@HOST:PORT/DATABASE_NAME
    DATABASE_URL="postgresql://postgres:mysecretpassword@localhost:5432/trip_mate"

    # --- Security Configuration ---
    # A strong, unique secret for signing JSON Web Tokens (JWTs).
    # You can generate one here: https://www.lastpass.com/features/password-generator
    JWT_SECRET="YOUR_SUPER_SECRET_AND_LONG_JWT_KEY"
    ```
    > **Important**: Ensure you have a PostgreSQL database created that matches the `DATABASE_NAME` in your `DATABASE_URL`.

4.  **Apply Database Migrations**
    This command reads your `prisma/schema.prisma` file and creates or updates the database tables accordingly.
    ```bash
    npx prisma migrate dev
    ```
    This will also generate the Prisma Client, a type-safe query builder for your database.

### Running the Application

-   **Development Mode**
    This command starts the server with hot-reloading, which automatically restarts the server when you save a file.
    ```bash
    npm run start:dev
    ```
    The API will be available at `http://localhost:3000`.

-   **Production Mode**
    To build and run the application for production:
    ```bash
    npm run build
    npm run start:prod
    ```

---

## üîê API Authentication Flow

The API is secured using JSON Web Tokens (JWT). All protected endpoints require a valid token.

1.  **Register or Login**: A new user signs up via `/auth/register` or an existing user signs in via `/auth/login`.
2.  **Receive Token**: Upon successful authentication, the API returns an `access_token`.
3.  **Authorize Requests**: For every subsequent request to a protected endpoint, you must include the `Authorization` header.

**Header Format**:
```
Authorization: Bearer <your_access_token>
```
Endpoints that require this header are marked with a üîí emoji in the documentation below.

---

## üìö API Endpoint Documentation

This section provides a complete reference for all available API endpoints.

### **Auth Module (`/auth`)**

Handles user registration and authentication.

#### 1. Register a New User
-   **Endpoint**: `POST /auth/register`
-   **Description**: Creates a new user account. The email must be unique.
-   **Authentication**: üîì Public
-   **Request Body**: `application/json`
    ```json
    {
      "email": "jane.doe@example.com",
      "password": "a-very-strong-password-123!",
      "name": "Jane Doe"
    }
    ```
    *   `email` (string, required, valid email format)
    *   `password` (string, required, min 8 characters)
    *   `name` (string, required)

-   **Success Response (201 Created)**:
    ```json
    {
        "id": "clxza1b2c3d4e5f6",
        "email": "jane.doe@example.com",
        "name": "Jane Doe"
    }
    ```
-   **Error Response (400 Bad Request)**: If validation fails or email is already taken.

#### 2. Login
-   **Endpoint**: `POST /auth/login`
-   **Description**: Authenticates a user with their email and password.
-   **Authentication**: üîì Public
-   **Request Body**: `application/json`
    ```json
    {
      "email": "jane.doe@example.com",
      "password": "a-very-strong-password-123!"
    }
    ```
-   **Success Response (200 OK)**:
    ```json
    {
      "access_token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
    }
    ```
-   **Error Response (401 Unauthorized)**: If credentials are invalid.

### **Users Module (`/users`)**

Handles user-specific data.

#### 1. Get Current User Profile
-   **Endpoint**: `GET /users/me`
-   **Description**: Retrieves the profile information of the currently authenticated user.
-   **Authentication**: üîí Protected
-   **Success Response (200 OK)**:
    ```json
    {
        "id": "clxza1b2c3d4e5f6",
        "email": "jane.doe@example.com",
        "name": "Jane Doe"
    }
    ```
-   **Error Response (401 Unauthorized)**: If the token is missing or invalid.

### **Trips Module (`/trips`)**

The core module for managing trips and all related data.

#### 1. Create a New Trip
-   **Endpoint**: `POST /trips`
-   **Description**: Creates a new trip. The user making the request automatically becomes the owner and a member of the trip.
-   **Authentication**: üîí Protected
-   **Request Body**: `application/json`
    ```json
    {
      "name": "Summer Trip to Japan",
      "description": "A 10-day adventure exploring Tokyo, Kyoto, and Osaka.",
      "startDate": "2024-07-20T00:00:00.000Z",
      "endDate": "2024-07-30T00:00:00.000Z"
    }
    ```
    *   `startDate` & `endDate` must be in ISO 8601 format.

-   **Success Response (201 Created)**:
    ```json
    {
        "id": "trip_abc123",
        "name": "Summer Trip to Japan",
        "description": "A 10-day adventure exploring Tokyo, Kyoto, and Osaka.",
        "startDate": "2024-07-20T00:00:00.000Z",
        "endDate": "2024-07-30T00:00:00.000Z",
        "ownerId": "user_xyz789",
        "createdAt": "...",
        "updatedAt": "..."
    }
    ```

#### 2. Get All User's Trips
-   **Endpoint**: `GET /trips`
-   **Description**: Retrieves a list of all trips that the authenticated user is a member of.
-   **Authentication**: üîí Protected
-   **Success Response (200 OK)**: An array of trip objects.
    ```json
    [
        {
            "id": "trip_abc123",
            "name": "Summer Trip to Japan",
            "description": "...",
            "startDate": "...",
            "endDate": "...",
            "ownerId": "user_xyz789"
        }
    ]
    ```

#### 3. Get a Single Trip by ID
-   **Endpoint**: `GET /trips/:id`
-   **Description**: Fetches all details for a specific trip, including members, destinations, activities, and expenses. The user must be a member of the trip to view it.
-   **Authentication**: üîí Protected
-   **Path Parameters**:
    *   `id` (string): The unique identifier of the trip.
-   **Success Response (200 OK)**:
    ```json
    {
        "id": "trip_abc123",
        "name": "Summer Trip to Japan",
        "description": "...",
        "members": [
            { "user": { "id": "user_xyz789", "name": "Jane Doe", "email": "jane.doe@example.com" } }
        ],
        "destinations": [ /* ... */ ],
        "activities": [ /* ... */ ],
        "expenses": [ /* ... */ ]
    }
    ```
-   **Error Response (404 Not Found)**: If the trip does not exist or the user is not a member.

#### 4. Update a Trip
-   **Endpoint**: `PUT /trips/:id`
-   **Description**: Updates a trip's details. Only the trip's owner can perform this action.
-   **Authentication**: üîí Protected
-   **Path Parameters**:
    *   `id` (string): The ID of the trip to update.
-   **Request Body**: `application/json` (fields are optional)
    ```json
    {
      "name": "An Epic Summer Trip to Japan",
      "description": "Updated description with more details."
    }
    ```
-   **Success Response (200 OK)**: The updated trip object.
-   **Error Response (403 Forbidden)**: If the user is not the owner of the trip.

#### 5. Delete a Trip
-   **Endpoint**: `DELETE /trips/:id`
-   **Description**: Deletes a trip and all its associated data (members, destinations, etc.). Only the trip's owner can perform this action.
-   **Authentication**: üîí Protected
-   **Path Parameters**:
    *   `id` (string): The ID of the trip to delete.
-   **Success Response (204 No Content)**: An empty response body.
-   **Error Response (403 Forbidden)**: If the user is not the owner.

#### 6. Add a Member to a Trip
-   **Endpoint**: `POST /trips/:id/members`
-   **Description**: Adds another registered user to the trip as a member. Only existing trip members can add new members.
-   **Authentication**: üîí Protected
-   **Path Parameters**:
    *   `id` (string): The ID of the trip.
-   **Request Body**:
    ```json
    {
      "email": "friend@example.com"
    }
    ```
-   **Success Response (201 Created)**: The full trip object with the updated member list.
-   **Error Response (404 Not Found)**: If the user with the given email does not exist or the trip doesn't exist.

#### 7. Remove a Member from a Trip
-   **Endpoint**: `DELETE /trips/:id/members/:userId`
-   **Description**: Removes a member from a trip. Only the trip owner can remove members. The owner cannot remove themselves.
-   **Authentication**: üîí Protected
-   **Path Parameters**:
    *   `id` (string): The ID of the trip.
    *   `userId` (string): The ID of the user to remove.
-   **Success Response (200 OK)**: The full trip object with the updated member list.
-   **Error Response (403 Forbidden)**: If the user making the request is not the trip owner.
-   **Error Response (400 Bad Request)**: If trying to remove the owner of the trip.

---

### **Destinations Sub-Module (`/trips/:id/destinations`)**

Manage the places you'll visit on your trip.

#### 8. Add a Destination to a Trip
-   **Endpoint**: `POST /trips/:id/destinations`
-   **Description**: Adds a new destination to the trip's itinerary. Only members of the trip can add destinations.
-   **Authentication**: üîí Protected
-   **Path Parameters**:
    *   `id` (string): The ID of the trip.
-   **Request Body**: `application/json`
    ```json
    {
      "name": "Kyoto",
      "country": "Japan",
      "arrivalDate": "2024-07-25T00:00:00.000Z",
      "departureDate": "2024-07-28T00:00:00.000Z"
    }
    ```
-   **Success Response (201 Created)**: The newly created destination object.
    ```json
    {
        "id": "dest_def456",
        "name": "Kyoto",
        "country": "Japan",
        "arrivalDate": "2024-07-25T00:00:00.000Z",
        "departureDate": "2024-07-28T00:00:00.000Z",
        "tripId": "trip_abc123"
    }
    ```

#### 9. Update a Destination
-   **Endpoint**: `PUT /trips/:tripId/destinations/:destinationId`
-   **Description**: Updates the details of a destination. Only trip members can update.
-   **Authentication**: üîí Protected
-   **Path Parameters**:
    *   `tripId` (string): The ID of the trip.
    *   `destinationId` (string): The ID of the destination to update.
-   **Request Body**: `application/json` (fields are optional)
    ```json
    {
      "name": "Kyoto (Ancient Capital)"
    }
    ```
-   **Success Response (200 OK)**: The updated destination object.

#### 10. Delete a Destination
-   **Endpoint**: `DELETE /trips/:tripId/destinations/:destinationId`
-   **Description**: Deletes a destination from a trip. Only trip members can delete.
-   **Authentication**: üîí Protected
-   **Path Parameters**:
    *   `tripId` (string): The ID of the trip.
    *   `destinationId` (string): The ID of the destination to delete.
-   **Success Response (204 No Content)**: An empty response body.

---

### **Activities Sub-Module (`/trips/.../activities`)**

Manage the activities you'll do at each destination.

#### 11. Add an Activity to a Destination
-   **Endpoint**: `POST /trips/:tripId/destinations/:destinationId/activities`
-   **Description**: Adds a new activity to a specific destination within a trip. Only trip members can add activities.
-   **Authentication**: üîí Protected
-   **Path Parameters**:
    *   `tripId` (string): The ID of the trip.
    *   `destinationId` (string): The ID of the destination for this activity.
-   **Request Body**: `application/json`
    ```json
    {
      "name": "Visit Fushimi Inari Shrine",
      "date": "2024-07-26T09:00:00.000Z",
      "description": "Hike through the thousands of torii gates."
    }
    ```
-   **Success Response (201 Created)**: The newly created activity object.
    ```json
    {
        "id": "act_ghi789",
        "name": "Visit Fushimi Inari Shrine",
        "date": "2024-07-26T09:00:00.000Z",
        "description": "Hike through the thousands of torii gates.",
        "destinationId": "dest_def456"
    }
    ```

#### 12. Update an Activity
-   **Endpoint**: `PUT /trips/:tripId/activities/:activityId`
-   **Description**: Updates the details of an activity. Only trip members can update.
-   **Authentication**: üîí Protected
-   **Path Parameters**:
    *   `tripId` (string): The ID of the trip.
    *   `activityId` (string): The ID of the activity to update.
-   **Request Body**: `application/json` (fields are optional)
    ```json
    {
      "description": "Early morning hike to avoid the crowds."
    }
    ```
-   **Success Response (200 OK)**: The updated activity object.

#### 13. Delete an Activity
-   **Endpoint**: `DELETE /trips/:tripId/activities/:activityId`
-   **Description**: Deletes an activity from a trip. Only trip members can delete.
-   **Authentication**: üîí Protected
-   **Path Parameters**:
    *   `tripId` (string): The ID of the trip.
    *   `activityId` (string): The ID of the activity to delete.
-   **Success Response (204 No Content)**: An empty response body.

---

### **Expenses Sub-Module (`/trips/:id/expenses`)**

Manage and track shared expenses for a trip.

#### 14. Add an Expense to a Trip
-   **Endpoint**: `POST /trips/:id/expenses`
-   **Description**: Logs a new expense for the trip. The user making the request is automatically assigned as the `paidById`. Only trip members can add expenses.
-   **Authentication**: üîí Protected
-   **Path Parameters**:
    *   `id` (string): The ID of the trip.
-   **Request Body**: `application/json`
    ```json
    {
      "description": "Shinkansen Tickets (Tokyo to Kyoto)",
      "amount": 130.50,
      "category": "TRANSPORTATION"
    }
    ```
    *   `category` must be one of the following: `FOOD`, `TRANSPORTATION`, `ACCOMMODATION`, `ACTIVITIES`, `OTHER`.

-   **Success Response (201 Created)**: The newly created expense object.
    ```json
    {
        "id": "exp_jkl012",
        "description": "Shinkansen Tickets (Tokyo to Kyoto)",
        "amount": 130.5,
        "category": "TRANSPORTATION",
        "date": "2023-10-27T10:00:00.000Z",
        "tripId": "trip_abc123",
        "paidById": "user_xyz789"
    }
    ```

#### 15. Update an Expense
-   **Endpoint**: `PUT /trips/:tripId/expenses/:expenseId`
-   **Description**: Updates the details of an expense. Only the user who originally added the expense can update it.
-   **Authentication**: üîí Protected
-   **Path Parameters**:
    *   `tripId` (string): The ID of the trip.
    *   `expenseId` (string): The ID of the expense to update.
-   **Request Body**: `application/json` (fields are optional)
    ```json
    {
      "amount": 135.00
    }
    ```
-   **Success Response (200 OK)**: The updated expense object.
-   **Error Response (403 Forbidden)**: If the user is not the one who paid for the expense.

#### 16. Delete an Expense
-   **Endpoint**: `DELETE /trips/:tripId/expenses/:expenseId`
-   **Description**: Deletes an expense from a trip. Only the user who added the expense can delete it.
-   **Authentication**: üîí Protected
-   **Path Parameters**:
    *   `tripId` (string): The ID of the trip.
    *   `expenseId` (string): The ID of the expense to delete.
-   **Success Response (204 No Content)**: An empty response body.
-   **Error Response (403 Forbidden)**: If the user is not the one who paid for the expense.

---

## ü§ù Contributing

Contributions are what make the open-source community such an amazing place to learn, inspire, and create. Any contributions you make are **greatly appreciated**.

If you have a suggestion that would make this better, please fork the repo and create a pull request. You can also simply open an issue with the tag "enhancement".

1.  Fork the Project
2.  Create your Feature Branch (`git checkout -b feature/AmazingFeature`)
3.  Commit your Changes (`git commit -m 'Add some AmazingFeature'`)
4.  Push to the Branch (`git push origin feature/AmazingFeature`)
5.  Open a Pull Request

---

## üìú License

This project is distributed under the MIT License. See `LICENSE` for more information.

---
Happy Travels and Happy Coding!